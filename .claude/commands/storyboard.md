# storyboard

**描述**: 为剧集生成分镜脚本（需要先完成正文）

**用法**: `/storyboard <集数或范围>`

**参数**:
- `<集数或范围>`: 指定要生成分镜的剧集
  - 单集: `Episode-05` 或 `05`
  - 多集: `Episode-05-10` 或 `05-10`
  - 默认: 查询用户需要生成的集数

**前置条件**: 必须先完成对应剧集的正文创作（Episode-XX.md 文件已存在）

---

## 执行流程

当用户调用 `/storyboard` 命令时:

1. **询问生成范围**

如果用户未指定集数,询问要生成分镜的剧集:
```
🎬 分镜脚本生成

请选择要生成分镜脚本的剧集范围:
1. 单集生成 (示例: Episode-05)
2. 批量生成 (示例: Episode-05-10)
3. 查看已完成剧集列表

请输入集数或范围 (如: 05 或 05-10):
```

2. **检查前置条件**

   检查指定的剧集是否已完成正文创作:
   - 检查 `episodes/Episode-XX.md` 文件是否存在
   - 如果文件不存在,提示需要先完成正文创作
   - 如果存在,继续执行

3. **读取所需资源**

针对每集生成,读取以下文件:

**a) 剧情内容**
   - 读取目标剧集的 `episodes/Episode-XX.md` 文件
   - 解析剧集标题、一句话简介
   - 提取关键场景和高潮片段

**b) 人物信息**
   - 读取 `characters.md` 获取所有人物设定
   - 重点提取主角的完整外观描述
   - 包括:年龄、性别、体型、发型、服装、面部特征等

**c) 创作方法论**
   - 读取 `skills/doomsday-skill/doomsday-storyboard-method.md`
   - 获取分镜规则(时长限制、视角适配等)
   - 学习提示词工程技巧

**d) 模板与示例**
   - 读取 `skills/doomsday-skill/templates/doomsday-storyboard-template.md`
   - 读取 `skills/doomsday-skill/examples/storyboard-example.md`

**e) 视觉风格**
   - 读取 `skills/doomsday-skill/doomsday-output-style.md`
   - 提取适用于分镜的形容词库和氛围词库

4. **分析剧集结构**

针对每个剧集执行以下分析:

**a) 识别关键场景**
   - 分析"起承转钩"结构,识别最具视觉化价值的场景
   - 提取爽点场景(囤货展示、复仇打脸等)
   - 定位需要强调的情绪转折点

**b) 场景时长规划**
   - 计算目标视频总时长(通常30-60秒/集)
   - 按每镜头5-10秒规则,规划镜头数量(6-12个/集)
   - 为不同场景分配合适时长:
     * 环境展示: 3-4秒
     * 主角动作: 5-6秒
     * 情绪特写: 4-5秒
     * 高潮场景: 6-8秒

**c) 确定视角策略**

根据漫剧类型选择视角:
   - **自拍视角**: 适合日常vlog风格、第一人称日记
   - **第一人称**: 适合沉浸式体验、紧张场面
   - **第三人称**: 最常见,适合全面展现剧情(默认选择)
   - **混合视角**: 不同场景切换视角(不推荐新手)

**d) 风格定位**

读取用户偏好或默认选择:
   - 视觉风格: 电影感 / 动画风 / 写实 / 卡通
   - 情绪基调: 紧张 / 爽快 / 绝望 / 希望
   - 特殊效果: 实拍感 / 虚化背景 / 光影对比

5. **生成分镜脚本**

针对每个镜头,生成完整信息:

**a) 镜头编号与时长**
   - 按1, 2, 3...顺序编号
   - 分配5-10秒时长(严格遵守规则)
   - 累计时长匹配目标总时长

**b) 场景描述**
   - 简洁描述画面内容
   - 突出主角动作和情绪
   - 注明关键道具和环境

**c) 文生图提示词生成**

按以下结构生成:
```
{景别选择}, {角色外观}, {主体描述}, {环境场景}, {情绪氛围}, {视觉风格}, {光影效果}
```

**关键要求**:
   - 景别根据视角智能选择(自拍/主观/三称)
   - 角色外观必须完整重复(characters.md中的完整描述)
   - 主体描述使用单帧静态画面(避免"边...边...")
   - 环境场景与前镜头保持一致性
   - 情绪氛围与剧情高潮契合
   - 视觉风格与项目定位一致
   - 光影效果具体化(顶光/侧光/背光等)

**d) 图生视频提示词生成**

按以下结构生成:
```
{镜头描述}, {镜头运动}, {主体行为}, {背景变化}, {环境变化}
```

**关键要求**:
   - 动作链使用"→"或"紧接着"连接
   - 严格控制在5-10秒内完成
   - 首帧承接文生图静态画面
   - 结尾添加稳定性要求
   - 示例: "保持角色面部清晰、光线稳定、无闪烁"

**e) 备注信息**
   - 道具一致性要求
   - 动作衔接提示
   - 特殊效果说明
   - 风险点提示(可能出错的描述)

6. **执行时长检查**

生成分镜后强制检查:
   - 逐一核对每个镜头时长(必须≤10秒)
   - 如有超时镜头,立即拆分为多个镜头
   - 重新编号,调整场景描述
   - 循环检查直到全部符合规则

7. **格式化为表格**

将分镜信息整理为Markdown表格:
```markdown
| 镜头 | 时长(秒) | 场景描述 | 文生图提示词 | 图生视频提示词 | 备注 |
|:---:|:---:|:---:|:---:|:---:|:---:|
| 1 | 5 | 主角打开仓库门 | [文生图提示词] | [图生视频提示词] | [备注] |
| 2 | 6 | 主角看到物资 | [文生图提示词] | [图生视频提示词] | [备注] |
| ... | ... | ... | ... | ... | ... |
```

8. **保存分镜脚本**

**保存位置**: `storyboards/storyboard-Episode-XX.md`

**文件内容结构**:
   ```markdown
   # Episode-XX 分镜脚本: [剧集标题]

   ## 基本信息
   - **剧集编号**: Episode-XX
   - **剧集标题**: [从catalog.md获取]
   - **目标时长**: XX秒
   - **视频视角**: [自拍视角/第一人称/第三人称]
   - **视觉风格**: [电影感/动画风/写实/卡通]
   - **角色**: [主角姓名]

   ## 主角外观描述(必填)
   [完整复制characters.md中的主角外观描述]

   ## 分镜脚本
   [Markdown表格]

   ## 创作说明
   - 本集关键场景: [说明]
   - 爽点分布: [说明]
   - 提示词优化建议: [说明]
   ```

9. **完成提示(单集)**

```
✅ Episode-XX 分镜脚本已完成

📊 本集统计:
- 镜头数量: X个
- 总时长: XX秒
- 视觉风格: [风格]
- 视频视角: [视角]

📁 文件位置: storyboards/storyboard-Episode-XX.md

💡 生成的提示词特点:
✓ 每个镜头均≤10秒
✓ 角色一致性已确保
✓ 视角适配已优化
✓ 提示词格式规范
✓ 可直接用于AI生成

[继续生成方式]
- 输入 /storyboard 下一集编号 (如: 06)
- 输入 /storyboard 批量生成 (如: 06-10)
- 输入 /status 查看整体进度
```

10. **批量生成流程(如果指定范围)**

如果是 `Episode-05-10` 格式:

- 循环执行步骤2-9,为每集生成分镜
   - 每完成1集显示进度
   - 继续下一集,直到全部完成

- 批量完成提示:
```
🎉 批量分镜脚本完成

📊 生成统计:
- 剧集范围: Episode-XX 至 Episode-XX
- 总集数: X集
- 总镜头数: XX个
- 总时长: XXX秒

📁 文件位置: storyboards/storyboard-Episode-XX.md (共X个文件)

💡 下一步建议:
- 输入 /status 查看整体进度
- 继续生成其他剧集分镜
- 人工审查关键场景的提示词质量
```

---

## 核心要求

### 严格时长控制
- 每个镜头时长必须 5-10秒
- 超时的镜头必须拆分
- 简单动作: 5-6秒
- 复杂动作: 8-10秒
- 绝不允许多个动作堆在一个镜头

### 角色一致性强制要求
- 每个分镜的文生图提示词必须完整重复主角外观描述
- 从characters.md完整复制角色外貌信息
- 包括:年龄、性别、体型、发型、服装、面部特征等
- 防止跨镜头的角色形象漂移

### 视角适配规则

**自拍视角**:
- 使用"自拍角度"、"手机自拍视角"等描述
- 禁止出现"手持手机"、"自拍杆"等元素
- 景别不适用远/中/近景

**第一人称视角**:
- 使用"第一人称视角"、"POV"、"主观镜头"
- 不出现主角正面全貌
- 观众视角即主角视角

**第三人称视角**:
- 使用传统景别:远景、中景、近景、特写
- 可以有完整的主角画面
- 最常见的漫剧视角

### 提示词质量要求

**文生图提示词结构**:
```
{景别选择}, {角色外观}, {主体描述}, {环境场景}, {情绪氛围}, {视觉风格}, {光影效果}
```

**关键检查点**:
- 角色外观描述完整
- 主体描述是静态画面(无"边A边B")
- 环境与前镜头一致
- 情绪与剧情匹配
- 风格统一
- 光影具体化

**图生视频提示词结构**:
```
{镜头描述}, {镜头运动}, {主体行为}, {背景变化}, {环境变化}
```

**关键检查点**:
- 动作链清晰(使用"→")
- 时长5-10秒内可完成
- 首帧与文生图一致
- 结尾有稳定性要求
- 无超时动作

### 场景设计原则

**单集场景数量**:
- 建议每集分镜包含 6-12个镜头
- 前三集镜头稍多(交代背景)
- 中期剧集镜头适中(8-10个)
- 高潮集可适当增加(10-12个)

**场景切换建议**:
- 每3-4个镜头切换一次空间
- 避免多个镜头在同一空间产生布局冲突
- 示例: 客厅→卧室→厨房→客厅
- 回程镜头可以使用之前已验证的空间布局

**爽点场景处理**:
- 囤货场景:多角度展示物资(全景→中景→特写)
- 复仇打脸:对比镜头(反派→主角→观众反应)
- 天灾来袭:第一人称视角增加沉浸感
- 重生觉醒:闪回与现实对比

### 画面设计要点

**第一帧原则**:
- 文生图描述的是静态首帧
- 状态而非过程("站立"而非"正在走路")
- 后续需要露脸的,首帧就要露脸
- 后续无需露脸的,可用背影或无脸特写

**道具一致性**:
- 跨镜头的道具位置保持一致
- 防止AI生图幻觉导致物品漂移
- 备注栏注明关键道具位置

**光线统一**:
- 同一空间的光线保持一致
- 注明光源方向(顶光/侧光/逆光)
- 特殊时刻标注光线变化(开灯/关灯)

### 错误预防清单

生成分镜前检查:
- [ ] 角色外观描述是否完整
- [ ] 时长是否都在5-10秒范围
- [ ] 视角描述是否一致
- [ ] 首帧是否为静态画面
- [ ] 是否添加了稳定性要求
- [ ] 场景切换是否合理
- [ ] 爽点是否得到视觉化呈现

生成分镜后检查:
- [ ] 每个镜头都有完整的文生图提示词
- [ ] 每个镜头都有图生视频提示词
- [ ] 备注栏有特殊要求说明
- [ ] 提示词使用中文
- [ ] 文件名遵循规范

---

## 注意事项

### 前置条件必须满足
- 必须先完成 `/write` 命令,生成了正文内容
- 对应的 `episodes/Episode-XX.md` 文件必须存在
- `characters.md` 中必须有完整的主角外观描述
- 缺少任一文件都不能生成分镜脚本

### 生成分镜的时机
- 建议完成每批5集正文后立即生成分镜
- 剧情在记忆中仍清晰,转换质量更高
- 分步生成,及时发现问题
- 不建议等60集全部完成再统一生成

### 提示词优化建议
- 批量生成后,人工审查关键场景
- 根据AI工具特性微调提示词
- 记录成功/失败的提示词模式
- 建立项目的"提示词库"

### 分镜脚本的使用
- 生成的分镜脚本可直接用于AI视频工作流
- 文生图 → 图生视频的链条清晰
- 可配合Midjourney、Stable Diffusion等使用
- 视频生成可使用Runway、Pika、Sora等工具

### 质量控制
- 分镜生成不自动触发检查(不同于正文)
- 建议人工抽查10-20%的分镜质量
- 重点检查角色一致性和提示词可行性
- 发现问题及时修改模板和示例

### 文件管理
- 分镜脚本统一存放在 `storyboards/` 目录
- 文件名格式: `storyboard-Episode-XX.md`
- 与正文文件一一对应
- 便于后续视频制作时查找

### 创意自由度
- 模板提供规范,但允许创新
- 根据具体剧情调整镜头数量
- 特殊场景可灵活处理时长
- 目标是最佳视觉呈现,不是机械套用

### 学习成本
- 初次使用建议从单集开始
- 先分析 `storyboard-example.md`
- 理解原理后再批量生成
- 不要急于求成

---

## 示例调用

### 示例1: 单集生成
```
用户: /storyboard Episode-05

AI: 🎬 开始生成分镜脚本
    📖 读取 Episode-05 正文内容...
    👤 提取主角外貌描述...
    📚 调用分镜创作方法论...

AI: ✅ Episode-05 分镜脚本已生成

    📊 本集统计:
    - 镜头数量: 8个
    - 总时长: 42秒
    - 视觉风格: 写实
    - 视频视角: 第三人称

    📁 文件位置: storyboards/storyboard-Episode-05.md

    💡 下一步:
    - 输入 /storyboard 06 继续生成
    - 输入 /storyboard 06-10 批量生成
    - 输入 /status 查看整体进度
```

### 示例2: 批量生成
```
用户: /storyboard Episode-11-15

AI: 🎬 批量分镜脚本生成
    📊 生成范围: Episode-11 至 Episode-15 (共5集)

AI: Episode-11 分镜生成中... ✅ 8个镜头 40秒
AI: Episode-12 分镜生成中... ✅ 9个镜头 46秒
AI: Episode-13 分镜生成中... ✅ 7个镜头 35秒
AI: Episode-14 分镜生成中... ✅ 10个镜头 52秒
AI: Episode-15 分镜生成中... ✅ 8个镜头 41秒

AI: 🎉 批量分镜脚本完成

📊 生成统计:
- 剧集范围: Episode-11 至 Episode-15
- 总集数: 5集
- 总镜头数: 42个
- 总时长: 214秒

📁 文件位置: storyboards/ (共5个文件)

💡 下一步建议:
- 人工审查关键场景提示词质量
- 继续生成其他剧集分镜
- 输入 /status 查看整体进度
```

### 示例3: 前置条件不满足
```
用户: /storyboard Episode-20

AI: ⚠️ 无法生成分镜脚本

❌ 缺少前置条件:
- episodes/Episode-20.md 不存在

💡 建议:
请先完成正文创作:
- 输入 /write 继续创作 Episode-20
- 或确认剧集成品是否已完成

当前已完成的剧集:
- Episode-01 ~ Episode-15 (共15集)
```

---

## 高级功能(可选)

### 智能场景识别
- 自动识别剧中高潮、爽点、转折场景
- 在提示词中使用"特写"等强调镜头
- 增加关键场景的时长占比

### 人物表情库
- 为频繁出现的表情建立表情词库
- 如"冷笑"、"得意的眼神"、"惊恐"等
- 提高提示词复用性和一致性

### 空间映射
- 维护常用场景的空间布局图
- 如"客厅"、"仓库"、"书房"等
- 在备注中引用空间编号,确保跨镜头一致性

### 批量优化
- 批量生成后,统一优化提示词
- 替换同义词,增加多样性
- 调整语气,匹配整体风格

---

## 版本说明

- **版本**: v1.0
- **创建日期**: 2025-12-10
- **适配项目**: 末世重生漫剧创作系统
- **配套文件**:
  - `skills/doomsday-skill/doomsday-storyboard-method.md`
  - `skills/doomsday-skill/templates/doomsday-storyboard-template.md`
  - `skills/doomsday-skill/examples/storyboard-example.md`
