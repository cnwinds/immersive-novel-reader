# write

**描述**: 开始或继续正文创作(需要先完成大纲、人物、目录)

**用法**: `/write`

**参数**: 无

**前置条件**: 必须先完成 `/outline`、`/character`、`/catalog` 命令

---

## 执行流程

当用户调用 `/write` 命令时:

1. **检查前置条件**
   - 检查 `outline.md` 是否存在
   - 检查 `characters.md` 是否存在
   - 检查 `catalog.md` 是否存在
   - 如果任一文件不存在,提示缺少哪个文件,并说明需要先完成前置步骤
   - 如果都存在,继续执行

2. **确定写作进度**
   - 检查 `episodes/` 目录
   - 查找已完成的集数 (Episode-01.md, Episode-02.md, ...)
   - 确定下一个要写的集数
   - 如果是首次创作,从 Episode-01 开始
   - 如果已有内容,从最后完成的集数+1继续

3. **读取所需资源**
   - 读取 `outline.md` 获取整体设定和三幕结构
   - 读取 `characters.md` 获取人物信息
   - 读取 `catalog.md` 获取当前集的剧情规划
   - 读取最近3集的内容 (如果有) 保持连贯性
   - 读取 `skills/doomsday-skill/doomsday-output-style.md` 获取写作风格
   - 读取 `skills/doomsday-skill/templates/doomsday-chapter-template.md` 获取格式规范
   - 读取 `skills/doomsday-skill/examples/chapter-example.md` 学习优秀范例

4. **批次创作模式**
   - 每次创作5集为一批
   - 在内存中生成5集内容,暂不写入文件
   - 生成完成后,自动调用 `/check` 进行一致性检查

5. **单集创作标准**
   
   每一集必须包含:
   
   **a) 集数标题区**
   - Episode编号
   - 集标题 (从catalog.md获取)
   - 一句话简介
   
   **b) 正文内容 (500-800字)**
   
   采用"起承转钩"四段式结构:
   
   - **起** (100-150字): 场景切入
     - 画面感强的开场
     - 交代时间、地点、人物
     - 制造悬念或铺垫冲突
   
   - **承** (200-300字): 冲突展开
     - 主要剧情推进
     - 人物互动和对话
     - 矛盾逐渐激化
   
   - **转** (150-200字): 爽点高潮
     - 核心爽点呈现
     - 主角优势展现
     - 反派被打脸或天灾应对成功
   
   - **钩** (50-100字): 悬念收尾
     - 留下悬念
     - 引出下一集
     - 制造期待感
   
   **c) 写作风格要求**
   
   - **短句为主**: 平均句长10-15字
   - **画面感**: 每个场景都要有清晰的视觉描述
   - **动作性**: 多用动词,少用形容词
   - **对话精炼**: 对话要有冲突感和信息量
   - **节奏明快**: 不拖沓,快速推进
   - **分镜思维**: 每段相当于一个漫画分镜

6. **一致性检查机制**
   
   创作完5集后:
   - 自动触发 `/check` 命令
   - 检查这5集是否与大纲一致
   - 检查人物行为是否符合设定
   - 检查天灾进程是否同步
   - 检查爽点分布是否合理
   
   **检查通过**:
   - 将5集内容写入 `episodes/Episode-XX.md` 文件
   - 显示进度: "已完成X/60集"
   - 询问用户是否继续下一批
   
   **检查未通过**:
   - 显示具体问题
   - 自动调用skill修改内容
   - 重新检查,直到通过
   - 不写入文件,重新生成

7. **完成提示 (每批完成后)**
   ```
   ✅ Episode XX-XX 创作完成并通过检查
   
   📝 本批进度:
   - 已完成: Episode XX-XX (5集)
   - 总进度: X/60集 (XX%)
   - 字数统计: 约X字
   
   💡 选项:
   - 输入 /write 继续下一批 (Episode XX-XX)
   - 输入 /check 重新检查最近5集
   - 输入 /status 查看整体进度
   ```

8. **全部完成提示 (60集写完后)**
   ```
   🎉 恭喜!全部60集创作完成!
   
   📊 创作统计:
   - 总集数: 60集
   - 总字数: 约X万字
   - 创作用时: X批次
   
   📁 文件位置:
   - 大纲: outline.md
   - 人物: characters.md
   - 目录: catalog.md
   - 正文: episodes/Episode-01.md ~ Episode-60.md
   
   💡 建议:
   - 通读全文,进行人工润色
   - 重点检查爽点密度和节奏
   - 优化对话和视觉描述
   - 确认分镜的可行性
   ```

<<<<<<< HEAD
=======
## 错误处理

### 前置文件缺失
- **情况**：执行 `/write` 时缺少 `outline.md`、`characters.md` 或 `catalog.md`
- **处理**：明确提示缺少哪个文件，说明需要先执行哪个命令
- **恢复**：用户完成前置步骤后，重新执行 `/write`

### 文件读取失败
- **情况**：无法读取设定文件或技能包文件
- **处理**：提示文件路径错误或文件不存在，中止创作
- **恢复**：检查文件路径，确认文件完整性后重新执行

### 检查循环失败
- **情况**：一致性检查连续3次返回FAIL状态
- **处理**：
  1. 显示详细的问题分析报告
  2. 询问用户选择：
     - **选项A**：接受当前版本（标记为"待优化"，继续下一批）
     - **选项B**：重新创作该批次（清空当前批次内容，重新生成）
     - **选项C**：跳过该批次（标记为"跳过"，继续下一批）
- **恢复**：根据用户选择执行相应操作

### 用户中断创作
- **情况**：用户在创作过程中中断（如关闭对话）
- **处理**：
  1. 已完成的批次已保存到文件，不会丢失
  2. 下次调用 `/write` 时自动检测进度，从最后完成的集数继续
  3. 调用 `/status` 可查看当前进度
- **恢复**：用户重新开始后，系统自动从断点继续

### 集数异常
- **情况**：检测到的已完成集数不连续或超出60集
- **处理**：提示集数异常，询问用户是否继续或重新开始
- **恢复**：根据用户选择执行相应操作

>>>>>>> df5392b (淇绔犺妭鏍囬鏄剧ず鍜屽皬璇村悕绉伴棶棰橈紝浼樺寲闃呰甯冨眬)
## 注意事项

- **批次创作**: 必须每5集一批,不能一次生成60集
- **质量检查**: 每批必须通过检查才能写入文件
- **保持连贯**: 每集创作前读取前3集内容
- **风格统一**: 严格遵循 doomsday-output-style.md 的风格
- **字数控制**: 单集500-800字,不能超出太多
- **不偏离大纲**: 如与大纲冲突,优先以大纲为准
- **爽点必达**: 每集必须有爽点,不能全是铺垫
<<<<<<< HEAD
=======
- **文件命名**: 正文文件统一命名为 `Episode-XX.md`，存放在 `episodes/` 目录
>>>>>>> df5392b (淇绔犺妭鏍囬鏄剧ず鍜屽皬璇村悕绉伴棶棰橈紝浼樺寲闃呰甯冨眬)

## 示例调用

```
用户: /write
AI: ✅ 检测到大纲、人物、目录已完成
     📝 开始创作 Episode 01-05...

AI: [读取outline.md, characters.md, catalog.md]
AI: [生成Episode 01-05内容]
AI: [自动触发/check]

AI: ✅ 一致性检查通过
     [写入Episode-01.md ~ Episode-05.md]

AI: ✅ Episode 01-05 创作完成并通过检查
     📝 本批进度:
     - 已完成: Episode 01-05 (5集)
     - 总进度: 5/60集 (8.3%)
     - 字数统计: 约3500字
     
     💡 选项:
     - 输入 /write 继续下一批 (Episode 06-10)
     - 输入 /status 查看整体进度
```