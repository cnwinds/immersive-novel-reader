# check

**描述**: 手动触发一致性检查(检查最近完成的5集内容)

**用法**: `/check`

**参数**: 无

**前置条件**: 必须已经创作了至少1集内容

---

## 执行流程

当用户调用 `/check` 命令时:

1. **确定检查范围**
   - 查找 `episodes/` 目录中最新完成的5集
   - 如果不足5集,检查所有已完成的集数
   - 如果没有任何内容,提示: "❌ 尚未开始创作,请先输入 /write"

2. **读取检查依据**
   - 读取 `outline.md` 获取整体设定和规划
   - 读取 `characters.md` 获取人物设定
   - 读取 `catalog.md` 获取对应集数的剧情规划
   - 读取待检查的5集正文内容

3. **执行7项一致性检查**

   **检查项1: 剧情一致性**
   - 正文内容是否与 catalog.md 中的规划一致
   - 是否偏离了大纲的主线剧情
   - 关键剧情点是否都有呈现
   
   **检查项2: 人物一致性**
   - 人物行为是否符合 characters.md 中的性格设定
   - 人物关系是否与设定一致
   - 出场人物是否符合规划
   
   **检查项3: 天灾进程一致性**
   - 天灾等级是否与当前集数匹配
   - 天灾表现是否符合 outline.md 中的设定
   - 天灾升级节奏是否合理
   
   **检查项4: 金手指一致性**
   - 金手指使用是否符合能力边界
   - 能力强度是否与设定一致
   - 是否出现了未定义的新能力
   
   **检查项5: 爽点质量检查**
   - 每集是否都有明确的爽点
   - 爽点类型是否符合规划 (囤货/复仇)
   - 爽点呈现是否有足够冲击力
   
   **检查项6: 格式规范检查**
   - 字数是否在500-800字范围
   - 是否采用了"起承转钩"结构
   - 画面感和节奏是否符合要求
   
   **检查项7: 上下文连贯性**
   - 与前面集数的衔接是否自然
   - 是否有逻辑漏洞或矛盾
   - 伏笔和回应是否匹配

4. **生成检查报告**

   **通过标准**: 7项检查全部通过
   
   **报告格式**:
   ```
   📋 一致性检查报告 - Episode XX-XX
   
   ✅ 剧情一致性: 通过
   ✅ 人物一致性: 通过
   ✅ 天灾进程一致性: 通过
   ✅ 金手指一致性: 通过
   ✅ 爽点质量: 通过
   ✅ 格式规范: 通过
   ✅ 上下文连贯性: 通过
   
   🎉 检查结果: 全部通过
   ```
   
   **如果有问题**:
   ```
   📋 一致性检查报告 - Episode XX-XX
   
   ✅ 剧情一致性: 通过
   ❌ 人物一致性: 未通过
      问题: Episode 23中主角性格过于软弱,与设定不符
   ✅ 天灾进程一致性: 通过
   ⚠️  金手指一致性: 警告
      问题: Episode 25中空间能力似乎超出了设定范围
   ✅ 爽点质量: 通过
   ✅ 格式规范: 通过
   ✅ 上下文连贯性: 通过
   
   ❌ 检查结果: 2项问题需要修复
   
   💡 建议:
   1. 修改Episode 23,强化主角的果断性格
   2. 调整Episode 25,限制空间能力的使用范围
   ```

5. **自动修复流程** (如果检查未通过)
   
   - 显示具体问题清单
   - 自动调用 doomsday-skill 进行内容修改
   - 只修改有问题的集数
   - 修改完成后,自动重新检查
   - 重复此流程直到通过

6. **检查通过后的操作**
   
   如果是在 `/write` 命令触发的自动检查:
   - 将内容写入文件
   - 更新进度
   - 提示继续下一批
   
   如果是用户手动调用 `/check`:
   - 仅显示检查结果
   - 如有问题,修改后更新文件
   - 提示用户当前状态

7. **完成提示**
   
   **检查通过**:
   ```
   ✅ 一致性检查全部通过
   
   📝 检查范围: Episode XX-XX (5集)
   💯 通过率: 100%
   
   💡 下一步:
   - 输入 /write 继续创作
   - 输入 /status 查看整体进度
   ```
   
   **检查修复完成**:
   ```
   ✅ 问题已修复并通过重新检查
   
   📝 检查范围: Episode XX-XX (5集)
   🔧 修复内容:
   - Episode XX: 修正人物性格描写
   - Episode XX: 调整金手指使用
   
   💡 下一步:
   - 输入 /write 继续创作
   - 输入 /status 查看整体进度
   ```

<<<<<<< HEAD
=======
## 错误处理

### 前置文件缺失
- **情况**：执行 `/check` 时缺少 `outline.md`、`characters.md` 或 `catalog.md`
- **处理**：明确提示缺少哪个文件，说明需要先完成哪个前置步骤
- **恢复**：用户完成前置步骤后，重新执行 `/check`

### 待检查文件不存在
- **情况**：`episodes/` 目录中没有已完成的集数
- **处理**：提示"尚未开始创作,请先输入 /write"
- **恢复**：用户执行 `/write` 创建内容后，再执行 `/check`

### 文件读取失败
- **情况**：无法读取检查基准文件或待检查的正文文件
- **处理**：提示文件路径错误或文件不存在，中止检查
- **恢复**：检查文件路径，确认文件完整性后重新执行

### 检查范围异常
- **情况**：待检查的集数不连续（如Episode-01、03、05）或集数超出60
- **处理**：在报告中标注异常，但仍检查可检查的内容
- **恢复**：建议检查文件命名和集数范围

### 检查循环失败
- **情况**：自动修复后连续3次检查仍FAIL
- **处理**：
  1. 生成详细的问题分析报告
  2. 询问用户选择：
     - **选项A**：接受当前版本（标记为"待优化"）
     - **选项B**：手动修改后重新检查
     - **选项C**：跳过检查，继续下一批
- **恢复**：根据用户选择执行相应操作

>>>>>>> df5392b (淇绔犺妭鏍囬鏄剧ず鍜屽皬璇村悕绉伴棶棰橈紝浼樺寲闃呰甯冨眬)
## 注意事项

- **自动触发**: `/write` 命令会自动触发检查,通常不需要手动调用
- **检查范围**: 默认检查最近5集,不检查更早的内容
- **严格标准**: 7项检查必须全部通过才能继续
<<<<<<< HEAD
- **自动修复**: 检查未通过时会自动修复,无需人工干预
- **以大纲为准**: 所有冲突都以 outline.md 为最高准则
- **不跳过检查**: 即使用户想跳过,也必须完成检查
=======
- **自动修复**: 检查未通过时会自动修复,最多循环3次
- **以大纲为准**: 所有冲突都以 outline.md 为最高准则
- **不跳过检查**: 即使用户想跳过,也必须完成检查
- **文件命名**: 确保检查的文件命名规范（Episode-XX.md）
>>>>>>> df5392b (淇绔犺妭鏍囬鏄剧ず鍜屽皬璇村悕绉伴棶棰橈紝浼樺寲闃呰甯冨眬)

## 示例调用

```
用户: /check
AI: 📋 开始检查最近5集内容 (Episode 16-20)...

AI: [读取outline.md, characters.md, catalog.md]
AI: [读取Episode-16.md ~ Episode-20.md]
AI: [执行7项检查]

AI: 📋 一致性检查报告 - Episode 16-20
     
     ✅ 剧情一致性: 通过
     ❌ 人物一致性: 未通过
        问题: Episode 18中反派李明的反应过于激烈,与设定不符
     ✅ 天灾进程一致性: 通过
     ✅ 金手指一致性: 通过
     ✅ 爽点质量: 通过
     ✅ 格式规范: 通过
     ✅ 上下文连贯性: 通过
     
     ❌ 检查结果: 1项问题需要修复
     
     🔧 开始自动修复...

AI: [调用skill修改Episode-18.md]
AI: [重新检查]

AI: ✅ 问题已修复并通过重新检查
     📝 检查范围: Episode 16-20 (5集)
     🔧 修复内容: Episode 18人物行为调整
     
     💡 下一步: 输入 /write 继续创作
```